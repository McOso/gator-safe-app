import{b as U,g as q}from"./index-CMVrdWBG.js";function F(d,g){for(var u=0;u<g.length;u++){const w=g[u];if(typeof w!="string"&&!Array.isArray(w)){for(const x in w)if(x!=="default"&&!(x in d)){const i=Object.getOwnPropertyDescriptor(w,x);i&&Object.defineProperty(d,x,i.get?i:{enumerable:!0,get:()=>w[x]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}var A={},S={},O={exports:{}},I;function W(){if(I)return O.exports;I=1;var d=typeof Reflect=="object"?Reflect:null,g=d&&typeof d.apply=="function"?d.apply:function(e,n,s){return Function.prototype.apply.call(e,n,s)},u;d&&typeof d.ownKeys=="function"?u=d.ownKeys:Object.getOwnPropertySymbols?u=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:u=function(e){return Object.getOwnPropertyNames(e)};function w(t){console&&console.warn&&console.warn(t)}var x=Number.isNaN||function(e){return e!==e};function i(){i.init.call(this)}O.exports=i,O.exports.once=H,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var y=10;function o(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(t){if(typeof t!="number"||t<0||x(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");y=t}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||x(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function v(t){return t._maxListeners===void 0?i.defaultMaxListeners:t._maxListeners}i.prototype.getMaxListeners=function(){return v(this)},i.prototype.emit=function(e){for(var n=[],s=1;s<arguments.length;s++)n.push(arguments[s]);var r=e==="error",c=this._events;if(c!==void 0)r=r&&c.error===void 0;else if(!r)return!1;if(r){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var m=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw m.context=a,m}var k=c[e];if(k===void 0)return!1;if(typeof k=="function")g(k,this,n);else for(var N=k.length,D=l(k,N),s=0;s<N;++s)g(D[s],this,n);return!0};function C(t,e,n,s){var r,c,a;if(o(n),c=t._events,c===void 0?(c=t._events=Object.create(null),t._eventsCount=0):(c.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),c=t._events),a=c[e]),a===void 0)a=c[e]=n,++t._eventsCount;else if(typeof a=="function"?a=c[e]=s?[n,a]:[a,n]:s?a.unshift(n):a.push(n),r=v(t),r>0&&a.length>r&&!a.warned){a.warned=!0;var m=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");m.name="MaxListenersExceededWarning",m.emitter=t,m.type=e,m.count=a.length,w(m)}return t}i.prototype.addListener=function(e,n){return C(this,e,n,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,n){return C(this,e,n,!0)};function P(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(t,e,n){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=P.bind(s);return r.listener=n,s.wrapFn=r,r}i.prototype.once=function(e,n){return o(n),this.on(e,b(this,e,n)),this},i.prototype.prependOnceListener=function(e,n){return o(n),this.prependListener(e,b(this,e,n)),this},i.prototype.removeListener=function(e,n){var s,r,c,a,m;if(o(n),r=this._events,r===void 0)return this;if(s=r[e],s===void 0)return this;if(s===n||s.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||n));else if(typeof s!="function"){for(c=-1,a=s.length-1;a>=0;a--)if(s[a]===n||s[a].listener===n){m=s[a].listener,c=a;break}if(c<0)return this;c===0?s.shift():p(s,c),s.length===1&&(r[e]=s[0]),r.removeListener!==void 0&&this.emit("removeListener",e,m||n)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var n,s,r;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var c=Object.keys(s),a;for(r=0;r<c.length;++r)a=c[r],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=s[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(e,n[r]);return this};function f(t,e,n){var s=t._events;if(s===void 0)return[];var r=s[e];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?_(r):l(r,r.length)}i.prototype.listeners=function(e){return f(this,e,!0)},i.prototype.rawListeners=function(e){return f(this,e,!1)},i.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):h.call(t,e)},i.prototype.listenerCount=h;function h(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]};function l(t,e){for(var n=new Array(e),s=0;s<e;++s)n[s]=t[s];return n}function p(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function _(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function H(t,e){return new Promise(function(n,s){function r(a){t.removeListener(e,c),s(a)}function c(){typeof t.removeListener=="function"&&t.removeListener("error",r),n([].slice.call(arguments))}E(t,e,c,{once:!0}),e!=="error"&&L(t,r,{once:!0})})}function L(t,e,n){typeof t.on=="function"&&E(t,"error",e,n)}function E(t,e,n,s){if(typeof t.on=="function")s.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function r(c){s.once&&t.removeEventListener(e,r),n(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}return O.exports}var T={},j;function G(){if(j)return T;j=1,Object.defineProperty(T,"__esModule",{value:!0}),T.numberToHex=T.getLowerCase=void 0;function d(u){return u&&u.toLowerCase()}T.getLowerCase=d;function g(u){return`0x${u.toString(16)}`}return T.numberToHex=g,T}var R;function K(){if(R)return S;R=1,Object.defineProperty(S,"__esModule",{value:!0}),S.SafeAppProvider=void 0;const d=U(),g=W(),u=G();class w extends g.EventEmitter{constructor(i,y){super(),this.submittedTxs=new Map,this.safe=i,this.sdk=y}async connect(){this.emit("connect",{chainId:this.chainId})}async disconnect(){}get chainId(){return this.safe.chainId}async request(i){const{method:y,params:o=[]}=i;switch(y){case"eth_accounts":return[this.safe.safeAddress];case"net_version":case"eth_chainId":return(0,u.numberToHex)(this.chainId);case"personal_sign":{const[f,h]=o;if(this.safe.safeAddress.toLowerCase()!==h.toLowerCase())throw new Error("The address or message hash is invalid");const l=await this.sdk.txs.signMessage(f);return("signature"in l?l.signature:void 0)||"0x"}case"eth_sign":{const[f,h]=o;if(this.safe.safeAddress.toLowerCase()!==f.toLowerCase()||!h.startsWith("0x"))throw new Error("The address or message hash is invalid");const l=await this.sdk.txs.signMessage(h);return("signature"in l?l.signature:void 0)||"0x"}case"eth_signTypedData":case"eth_signTypedData_v4":{const[f,h]=o,l=typeof h=="string"?JSON.parse(h):h;if(this.safe.safeAddress.toLowerCase()!==f.toLowerCase())throw new Error("The address is invalid");const p=await this.sdk.txs.signTypedMessage(l);return("signature"in p?p.signature:void 0)||"0x"}case"eth_sendTransaction":const v={...o[0],value:o[0].value||"0",data:o[0].data||"0x"};typeof v.gas=="string"&&v.gas.startsWith("0x")&&(v.gas=parseInt(v.gas,16));const C=await this.sdk.txs.send({txs:[v],params:{safeTxGas:v.gas}});return this.submittedTxs.set(C.safeTxHash,{from:this.safe.safeAddress,hash:C.safeTxHash,gas:0,gasPrice:"0x00",nonce:0,input:v.data,value:v.value,to:v.to,blockHash:null,blockNumber:null,transactionIndex:null}),C.safeTxHash;case"eth_blockNumber":return(await this.sdk.eth.getBlockByNumber(["latest"])).number;case"eth_getBalance":return this.sdk.eth.getBalance([(0,u.getLowerCase)(o[0]),o[1]]);case"eth_getCode":return this.sdk.eth.getCode([(0,u.getLowerCase)(o[0]),o[1]]);case"eth_getTransactionCount":return this.sdk.eth.getTransactionCount([(0,u.getLowerCase)(o[0]),o[1]]);case"eth_getStorageAt":return this.sdk.eth.getStorageAt([(0,u.getLowerCase)(o[0]),o[1],o[2]]);case"eth_getBlockByNumber":return this.sdk.eth.getBlockByNumber([o[0],o[1]]);case"eth_getBlockByHash":return this.sdk.eth.getBlockByHash([o[0],o[1]]);case"eth_getTransactionByHash":let b=o[0];try{b=(await this.sdk.txs.getBySafeTxHash(b)).txHash||b}catch{}return this.submittedTxs.has(b)?this.submittedTxs.get(b):this.sdk.eth.getTransactionByHash([b]).then(f=>(f&&(f.hash=o[0]),f));case"eth_getTransactionReceipt":{let f=o[0];try{f=(await this.sdk.txs.getBySafeTxHash(f)).txHash||f}catch{}return this.sdk.eth.getTransactionReceipt([f]).then(h=>(h&&(h.transactionHash=o[0]),h))}case"eth_estimateGas":return this.sdk.eth.getEstimateGas(o[0]);case"eth_call":return this.sdk.eth.call([o[0],o[1]]);case"eth_getLogs":return this.sdk.eth.getPastLogs([o[0]]);case"eth_gasPrice":return this.sdk.eth.getGasPrice();case"wallet_getPermissions":return this.sdk.wallet.getPermissions();case"wallet_requestPermissions":return this.sdk.wallet.requestPermissions(o[0]);case"safe_setSettings":return this.sdk.eth.setSafeSettings([o[0]]);case"wallet_sendCalls":{const{from:f,calls:h,chainId:l}=o[0];if(l!==(0,u.numberToHex)(this.chainId))throw new Error(`Safe is not on chain ${l}`);if(f!==this.safe.safeAddress)throw Error("Invalid from address");const p=h.map((L,E)=>{if(!L.to)throw new Error(`Invalid call #${E}: missing "to" field`);return{to:L.to,data:L.data??"0x",value:L.value??(0,u.numberToHex)(0)}}),{safeTxHash:_}=await this.sdk.txs.send({txs:p});return{id:_}}case"wallet_getCallsStatus":{const f=o[0],h={[d.TransactionStatus.AWAITING_CONFIRMATIONS]:100,[d.TransactionStatus.AWAITING_EXECUTION]:100,[d.TransactionStatus.SUCCESS]:200,[d.TransactionStatus.CANCELLED]:400,[d.TransactionStatus.FAILED]:500},l=await this.sdk.txs.getBySafeTxHash(f),p={version:"1.0",id:f,chainId:(0,u.numberToHex)(this.chainId),status:h[l.txStatus]};if(!l.txHash)return p;const _=await this.sdk.eth.getTransactionReceipt([l.txHash]);if(!_)return p;const H=l.txData?.dataDecoded?.method!=="multiSend"?1:l.txData.dataDecoded.parameters?.[0].valueDecoded?.length??1,L=Number(_.blockNumber),E=Number(_.gasUsed);return p.receipts=Array(H).fill({logs:_.logs,status:(0,u.numberToHex)(l.txStatus===d.TransactionStatus.SUCCESS?1:0),blockHash:_.blockHash,blockNumber:(0,u.numberToHex)(L),gasUsed:(0,u.numberToHex)(E),transactionHash:l.txHash}),p}case"wallet_showCallsStatus":throw new Error(`"${i.method}" not supported`);case"wallet_getCapabilities":return{[(0,u.numberToHex)(this.chainId)]:{atomicBatch:{supported:!0}}};default:throw Error(`"${i.method}" not implemented`)}}send(i,y){i||y("Undefined request"),this.request(i).then(o=>y(null,{jsonrpc:"2.0",id:i.id,result:o})).catch(o=>y(o,null))}}return S.SafeAppProvider=w,S}var M;function $(){return M||(M=1,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.SafeAppProvider=void 0;var g=K();Object.defineProperty(d,"SafeAppProvider",{enumerable:!0,get:function(){return g.SafeAppProvider}})})(A)),A}var B=$();const z=q(B),X=F({__proto__:null,default:z},[B]);export{X as i};
